cmake_minimum_required(VERSION 3.17)
project("OpenGL Tutorial")
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED TRUE)
find_package(OpenGL REQUIRED)
find_package(glfw3 REQUIRED)
find_package(glm REQUIRED)
find_package(assimp REQUIRED)
find_package(PNG REQUIRED)

find_program(GLSLC glslc REQUIRED)

set(GLSLC_FLAGS_DEBUG "-g")
set(GLSLC_FLAGS_RELEASE "-O")
set(GLSLC_FLAGS "--target-env=opengl")
if (${CMAKE_BUILD_TYPE} STREQUAL "Debug")
    set(GLSLC_FLAGS "${GLSLC_FLAGS} ${GLSLC_FLAGS_DEBUG}")
elseif(${CMAKE_BUILD_TYPE} STREQUAL "Release")
    set(GLSLC_FLAGS "${GLSLC_FLAGS} ${GLSLC_FLAGS_RELEASE}")
endif()

set(SHADERS_SOURCE_DIR "${CMAKE_SOURCE_DIR}/assets/shaders/src")
set(SHADERS_BINARY_DIR "${CMAKE_SOURCE_DIR}/assets/shaders/bin")

function(add_shader TARGET SHADER)
    set(SHADER_SOURCE_FILE ${SHADERS_SOURCE_DIR}/${SHADER})
    set(SHADER_BINARY_FILE ${SHADERS_BINARY_DIR}/${SHADER}.spv)
    get_filename_component(SHADER_BINARY_DIR ${SHADER_BINARY_FILE} DIRECTORY)
    file(MAKE_DIRECTORY ${SHADER_BINARY_DIR})
    add_custom_command(
        OUTPUT ${SHADER_BINARY_FILE}
        DEPENDS ${SHADER_SOURCE_FILE}
        COMMAND ${GLSLC} ${GLSLC_FLAGS} ${SHADER_SOURCE_FILE} -o ${SHADER_BINARY_FILE}
    )
    target_sources(${TARGET} PRIVATE ${SHADER_BINARY_FILE})
endfunction(add_shader)

project(glad)
add_library(glad SHARED "src/glad.c")
target_include_directories(glad PUBLIC "include/glad" OpenGL)
target_link_libraries(glad PUBLIC OpenGL)
if(${CMAKE_SYSTEM_NAME} STREQUAL "Linux")
    target_link_libraries(glad PRIVATE dl)
endif()

project(Camera)
add_library(Camera SHARED "src/Camera.cpp")
target_include_directories(Camera PUBLIC "include" glm)
target_link_libraries(Camera PUBLIC glm)

project(CameraManager)
add_library(CameraManager SHARED "src/CameraManager.cpp")
target_include_directories(CameraManager PUBLIC "include" glfw3 Camera glm)
target_link_libraries(CameraManager PUBLIC glfw Camera glm)

project(LoadModel)
add_library(LoadModel SHARED "src/load_model.cpp")
target_include_directories(LoadModel PUBLIC "include" glad glm PRIVATE assimp)
target_link_libraries(LoadModel PUBLIC glad glm PRIVATE assimp)

project(LoadShader)
add_library(LoadShader SHARED "src/load_shader.cpp")
target_include_directories(LoadShader PUBLIC "include" glad)
target_link_libraries(LoadShader PUBLIC glad)

project(LoadTexture)
add_library(LoadTexture SHARED "src/load_texture.cpp")
target_include_directories(LoadTexture PUBLIC "include" glad PRIVATE PNG)
target_link_libraries(LoadTexture PUBLIC glad PRIVATE png)

project(blending)
add_executable(blending "src/blending.cpp")
target_include_directories(blending PRIVATE "include" glfw3 glm glad)
target_link_libraries(blending PRIVATE glfw glm glad CameraManager LoadModel LoadShader LoadTexture)
add_shader(blending "blending/diffuse.vert")
add_shader(blending "blending/diffuse.frag")

project(cubemaps)
add_executable(cubemaps "src/cubemaps.cpp")
target_include_directories(cubemaps PRIVATE "include" glfw3 glm glad)
target_link_libraries(cubemaps PRIVATE glfw glm glad CameraManager LoadModel LoadShader LoadTexture)
add_shader(cubemaps "cubemaps/skybox.vert")
add_shader(cubemaps "cubemaps/skybox.frag")
add_shader(cubemaps "cubemaps/mirror.vert")
add_shader(cubemaps "cubemaps/mirror.frag")

project(shadows)
add_executable(shadows "src/shadows.cpp")
target_include_directories(shadows PRIVATE "include" glfw3 glm glad)
target_link_libraries(shadows PRIVATE glfw glm glad CameraManager LoadModel LoadShader)
add_shader(shadows "shadows/lighting.vert")
add_shader(shadows "shadows/lighting.frag")
add_shader(shadows "shadows/shadow.vert")
add_shader(shadows "shadows/shadow.geom")

project(instancing)
add_executable(instancing "src/instancing.cpp")
target_include_directories(instancing PRIVATE "include" glfw3 glm glad)
target_link_libraries(instancing PRIVATE glfw glm glad CameraManager LoadModel LoadShader)
add_shader(shadows "instancing/diffuse.vert")
add_shader(shadows "instancing/diffuse_instanced.vert")
add_shader(shadows "instancing/diffuse.frag")
